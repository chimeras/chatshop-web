<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery-1.3.min.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/json2.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery.zend.jsonrpc.js"></SCRIPT>
    <link rel="stylesheet" href="css/css.css"/>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <SCRIPT type="text/javascript">


        function getParameters() {
            var searchString = window.location.search.substring(1)
                    , params = searchString.split("&")
                    , hash = {}
                    ;

            for (var i = 0; i < params.length; i++) {
                var val = params[i].split("=");
                hash[unescape(val[0])] = unescape(val[1]);
            }
            return hash;
        }


        function getTheme(themeId) {
            var url = '/shop/';
            var testBasic = jQuery.Zend.jsonrpc({url:url});
            var result = testBasic.getThemeCategories(themeId);
            var obj = jQuery.parseJSON(result);

            if (obj.categories) {
                clearContainer();
                renderProducts(obj.categories);
            }
        }

        function clearContainer() {
            $("#container").html('');
        }

        function renderProducts(categories) {
            for (var i = 0; i < categories.length; i++) {
                $("#container").append('<div><p>' + categories[i].name + '</p></div>');
                var subcategories = $('<div></div>')
                for (var k = 0; k < categories[i].subcategories.length; k++) {
                    var formButton = $('<input />').attr('type', "button");

                    var subCategory = categories[i].subcategories[k];
                    formButton.attr('value', subCategory.name + '(' + subCategory.products_qty + ' items)');
                    if (subCategory.products_qty == 0) {
                        formButton.attr('disabled', 'disabled');
                    } else {
                        formButton.click(function () {
                            var url = '/shop/';
                            var testBasic = jQuery.Zend.jsonrpc({url:url});
                            var result = testBasic.getCategoryProducts($(this).attr('data'), "0", "50", null, null);
                            if (result && result.length > 0) {
                                var obj = jQuery.parseJSON(result);
                                if (obj.categories) {
                                    clearContainer();
                                    console.log(obj.categories);
                                    renderProducts(obj.categories);
                                }
                            } else {
                                $('#console').text('Error occured');
                            }
                            $('#console').append('<hr />');

                        }).attr('data', subCategory.id);
                    }


                    $(subcategories).append(formButton);
                }
                $('#container').append(subcategories);
                var table = $("<table class='table table table-striped table-bordered'><tr><td>Picture</td><td>Name</td><td>Advertiser keywords</td><td>Keywords</td><td>Sale</td><td>In Stock</td></tr></table>");
                for (j = 0; j < categories[i].products.length; j++) {
                    var row = $("<tr></tr>");
                    var a = $("<a></a>");
                    $(a).attr("href", categories[i].products[j].buy_url);
                    $(a).attr("target", "_blank");
                    var img = $("<img />")
                    $(img).attr("src", categories[i].products[j].image_url);
                    $(img).attr("width", "60");
                    $(a).append(img);
                    $("<td></td>").append(a).appendTo(row);
                    $("<td></td>").text(categories[i].products[j].name.replace(/\\/g, '')).appendTo(row);
                    $("<td></td>").text(categories[i].products[j].advertiser_keywords.replace(/\\/g, '')).appendTo(row);
                    $("<td></td>").text(categories[i].products[j].keywords.replace(/\\/g, '')).appendTo(row);
                    $("<td></td>").text(categories[i].products[j].saleprice || '').appendTo(row);
                    $("<td></td>").text(categories[i].products[j].in_stock).appendTo(row);
                    table.append(row);
                }
                $("#container").append(table);
            }
        }
    </SCRIPT>

</head>
<body>
<input type="button" value="handsome gorgeous" onclick="getTheme(1)"/>
<input type="button" value="Toys" onclick="getTheme(2)"/>

<div id="console"></div>
<div id="container"></div>
</body>
</html>

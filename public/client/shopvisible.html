<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang='en' xml:lang='en' xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery-1.3.min.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/json2.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery.js"></SCRIPT>
    <SCRIPT LANGUAGE="javascript" SRC="js/jquery.zend.jsonrpc.js"></SCRIPT>
    <link rel="stylesheet" href="css/css.css"/>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <SCRIPT type="text/javascript">

        $(document).ready(function () {
            var url = '/shop/';
            $.ajax({
                url:url,
                dataType:'json',
                success:function (data) {
                    var testBasic = jQuery.Zend.jsonrpc({url:url});

                    $.each(data.methods, function (index, member) {
                        var params = [];

                        var form = $('<form></form>').attr('action', url);

                        form.append($('<h2></h2>').text(index));
                        $.each(member.parameters, function (pindex, param) {
                            form.append($('<input type="text" />').attr('name', param.name).attr('id', 'param_' + index + '__' + param.name));
                            var label = $('<span></span>').html(param.name + ':<i>' + param.type + '</i>');

                            if (param.optional) {
                                label.append($('<span></span>').text(' (optional, default:' + param.default + ')'));
                            }
                            form.append(label);
                            form.append($('<br/>'));
                            params.push('$("#param_' + index + '__' + param.name + '").val()');
                        });
                        form.append($('<input />').attr('type', 'button').attr('id', 'submit_' + index));
                        $('body').append(form);
                        $('#submit_' + index).click(function () {
                            var paramsStr = params.join(',');
                            $('#console').append('var result = testBasic.' + index + '(' + paramsStr + ');');
                            $('#console').append('<br />');
                            eval('var result = testBasic.' + index + '(' + paramsStr + ');');
                            if (result && result.length > 0) {
                                var obj = jQuery.parseJSON(result);

                                if(obj.categories){
                                var i = 0;
                                for (i = 0; i < obj.categories.length; i++) {
                                    $("#products").append('<div><p>' + obj.categories[i].name + '</p></div>');
                                    var subcategories=$('<div></div>')
                                    for(var k=0; k<obj.categories[i].subcategories.length; k++){

                                     //   var postjson=JSON.stringify({"jsonrpc":"2.0","method":"getCategoryProducts","params":[obj.categories[i].subcategories[k].id,"","","",""],"id":1});

                                        var form = $('<form></form>').attr('action', url).attr("style","float:left");
                                        var formbutton=$('<input id="submit_getCategoryProducts" type="button">');
                                        $(formbutton).attr("value",obj.categories[i].subcategories[k].name);
                                   //     $(form).append(postjson);
                                        $(form).append(formbutton);
                                        $(subcategories).append(form);
                                    }
                                    $('#products').append(subcategories);
                                    var table = $("<table class='table table table-striped table-bordered'><tr><td>Picture</td><td>Name</td><td>Advertiser keywords</td><td>Keywords</td><td>Sale</td><td>In Stock</td></tr></table>");
                                    var j = 0;
                                    for (j = 0; j < obj.categories[i].products.length; j++) {
                                        //console.log(obj.categories[i].products[j]);
                                        var row = $("<tr></tr>");
                                        var a = $("<a></a>");
                                        $(a).attr("href", obj.categories[i].products[j].buy_url);
                                        $(a).attr("target", "_blank");
                                        var img = $("<img />")
                                        $(img).attr("src", obj.categories[i].products[j].image_url);
                                        $(img).attr("width", "60");
                                        $(a).append(img);
                                        $("<td></td>").append(a).appendTo(row);
                                        $("<td></td>").text(obj.categories[i].products[j].name.replace(/\\/g, '')).appendTo(row);
                                        $("<td></td>").text(obj.categories[i].products[j].advertiser_keywords.replace(/\\/g, '')).appendTo(row);
                                        $("<td></td>").text(obj.categories[i].products[j].keywords.replace(/\\/g, '')).appendTo(row);
                                        $("<td></td>").text(obj.categories[i].products[j].saleprice || '').appendTo(row);
                                        $("<td></td>").text(obj.categories[i].products[j].in_stock).appendTo(row);
                                        table.append(row);
                                    }
                                    console.log(obj.categories[i]);
                                    $("#products").append(table);
                                }
                            }
                                else {
                                   console.log(result);
                                }
                            } else {
                                $('#console').append('<strong />').text('Error occured');
                            }
                        });
                    });

                }
            });
        });

        function getParameters() {
            var searchString = window.location.search.substring(1)
                    , params = searchString.split("&")
                    , hash = {}
                    ;

            for (var i = 0; i < params.length; i++) {
                var val = params[i].split("=");
                hash[unescape(val[0])] = unescape(val[1]);
            }
            return hash;
        }

    </SCRIPT>

</head>
<body>
<a href="index.html">Auth client</a>

<div id="products">
    <p id="name"></p>
</div>
</body>
</html>
